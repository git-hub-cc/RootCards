<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <!-- PWA 配置 -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1f2937" media="(prefers-color-scheme: dark)">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="favicon.svg">

    <!-- SEO 核心配置区域 -->
    <title>英语词源意境记忆卡 | Etymology Visualizer</title>
    <meta name="description" content="PPMC词源意境记忆卡 (Etymology Visualizer) 是一个在线英语单词学习工具。">
    <meta name="keywords" content="英语单词记忆, 词源法, 词根词缀, 意境记忆, PPMC">
    <meta name="author" content="cc">
    <link rel="canonical" href="https://ppmc.club/">

    <!-- CSS 资源引入 -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/card.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/feature-listening.css">
    <link rel="stylesheet" href="css/feature-typing.css">
    <link rel="stylesheet" href="css/feature-wordbook.css">
    <link rel="stylesheet" href="css/feature-undo.css">
    <link rel="stylesheet" href="css/feature-notifications.css">

    <!-- 网站图标 -->
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
</head>
<body>

<!-- 全屏启动页 (Splash Screen) -->
<div id="app-splash-screen" class="app-splash-screen">
    <div class="splash-content">
        <div class="splash-logo-wrapper">
            <img src="favicon.svg" alt="Logo" class="splash-logo">
            <div class="splash-ripple"></div>
        </div>
        <h2 class="splash-title">词源意境记忆</h2>
        <p class="splash-subtitle">Etymology Visualizer</p>

        <div class="splash-loading-area">
            <p id="loading-progress-text" class="splash-status-text">正在解析词源数据...</p>
            <div class="splash-progress-track">
                <div id="loading-progress-bar" class="splash-progress-fill"></div>
            </div>
        </div>

        <div class="splash-quote">
            <p>“单词不是孤岛，而是积木的组合”</p>
        </div>
    </div>
</div>

<!-- 沉浸模式开关按钮 -->
<button id="immersive-mode-btn" class="floating-action-btn" title="切换沉浸模式">
    <svg class="icon-expand" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="15 3 21 3 21 9"></polyline>
        <polyline points="9 21 3 21 3 15"></polyline>
        <line x1="21" y1="3" x2="14" y2="10"></line>
        <line x1="3" y1="21" x2="10" y2="14"></line>
    </svg>
    <svg class="icon-compress is-hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="4 14 10 14 10 20"></polyline>
        <polyline points="20 10 14 10 14 4"></polyline>
        <line x1="14" y1="10" x2="21" y2="3"></line>
        <line x1="3" y1="21" x2="10" y2="14"></line>
    </svg>
</button>

<!-- 顶部导航与过滤器 -->
<header class="app-header">
    <h1>
        <img src="favicon.svg" alt="App Logo" class="header-logo">
        <div class="header-title-text">
            词源意境记忆
            <span class="subtitle">Etymology Visualizer</span>
        </div>
    </h1>

    <div class="app-slogan">
        <p>单词不是孤岛，而是<strong>积木</strong>的组合。</p>
        <p>
            <span class="highlight">前缀</span>决定方向与态度，
            <span class="highlight">词根</span>承载核心灵魂，
            <span class="highlight">后缀</span>标记词性身份。
        </p>
    </div>

    <div class="category-filter-container" id="category-filter-container"></div>
    <div class="content-type-filter-container" id="content-type-filter-container"></div>

    <div class="filter-container" id="filter-container">
        <!-- 筛选器按钮将由 JavaScript 动态生成 -->

        <div class="tool-group" id="tool-group">
            <div class="word-count-container">
                <div class="count-item" title="当前视图">
                    <span id="word-count-current" class="count-number">0</span>
                </div>
                <div class="count-item" title="已掌握">
                    <span id="word-count-learned" class="count-number">0</span>
                </div>
            </div>
            <button class="icon-btn" id="typing-mode-btn" title="拼写打字模式 (Typing Mode)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="4" width="20" height="16" rx="2" ry="2"></rect>
                    <line x1="6" y1="8" x2="6" y2="8"></line>
                    <line x1="10" y1="8" x2="10" y2="8"></line>
                    <line x1="14" y1="8" x2="14" y2="8"></line>
                    <line x1="18" y1="8" x2="18" y2="8"></line>
                    <line x1="6" y1="12" x2="6" y2="12"></line>
                    <line x1="10" y1="12" x2="10" y2="12"></line>
                    <line x1="14" y1="12" x2="14" y2="12"></line>
                    <line x1="18" y1="12" x2="18" y2="12"></line>
                    <line x1="6" y1="16" x2="18" y2="16"></line>
                </svg>
            </button>

            <button class="icon-btn" id="listening-mode-btn" title="听力磨耳朵模式 (Listening Mode)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                    <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
                </svg>
            </button>

            <!-- AI 语境对话模式入口按钮 -->
            <button class="icon-btn" id="dialogue-mode-btn" title="AI 语境对话模式 (Dialogue Mode)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                </svg>
            </button>

            <button class="icon-btn" id="no-visual-btn" title="开启无图自测模式 (Hide Visuals)">
                <svg class="icon-eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <svg class="icon-eye-slash is-hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
            </button>

            <button class="shuffle-btn icon-btn" id="shuffle-btn" title="随机排序当前卡片">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="16 3 21 3 21 8"></polyline>
                    <line x1="4" y1="20" x2="21" y2="3"></line>
                    <polyline points="21 16 21 21 16 21"></polyline>
                    <line x1="15" y1="15" x2="21" y2="21"></line>
                    <line x1="4" y1="4" x2="9" y2="9"></line>
                </svg>
            </button>

            <div class="options-menu-container">
                <button class="icon-btn" id="more-options-btn" title="更多操作">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle>
                    </svg>
                </button>
                <div class="options-dropdown-menu" id="options-menu">
                    <button class="menu-item" id="show-achievements-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>
                        查看成就
                    </button>
                    <div class="menu-divider"></div>
                    <button class="menu-item" id="show-heatmap-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line><path d="M8 14h.01"></path><path d="M12 14h.01"></path><path d="M16 14h.01"></path><path d="M8 18h.01"></path><path d="M12 18h.01"></path><path d="M16 18h.01"></path></svg>
                        学习轨迹
                    </button>
                    <div class="menu-divider"></div>
                    <button class="menu-item" id="import-learned-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                        导入已掌握
                    </button>
                    <button class="menu-item" id="export-learned-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                        导出已掌握
                    </button>
                    <button class="menu-item" id="export-current-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                        导出当前视图
                    </button>
                    <div class="menu-divider"></div>
                    <button class="menu-item" id="manage-wordbook-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                        管理单词本
                    </button>
                    <div class="menu-divider"></div>
                    <button class="menu-item" id="clear-learned-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                        清空已掌握
                    </button>
                    <div class="menu-divider"></div>
                    <button class="menu-item" id="theme-toggle-menu-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                        切换主题
                    </button>
                </div>
            </div>

            <div class="search-container" id="search-container">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input type="search" id="search-input" class="search-input" placeholder="搜索 (Search)..." autocomplete="off">
            </div>
        </div>
    </div>
</header>

<!-- 主内容区域 -->
<main class="card-grid" id="card-grid">
    <div id="skeleton-loader">
        <div class="skeleton-card"><div class="skeleton-badge"></div><div class="skeleton-visual"></div><div class="skeleton-word"></div><div class="skeleton-hint"></div></div>
        <div class="skeleton-card"><div class="skeleton-badge"></div><div class="skeleton-visual"></div><div class="skeleton-word"></div><div class="skeleton-hint"></div></div>
    </div>

    <div id="load-more-trigger" class="load-more-trigger">
        <svg class="spinner" viewBox="0 0 50 50">
            <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
        </svg>
    </div>
</main>

<!-- 移动端底部固定导航栏容器 -->
<nav id="mobile-bottom-bar" class="mobile-bottom-bar"></nav>

<!-- 模态框与模板区域 -->
<div id="listening-modal" class="modal-overlay is-hidden">
    <!-- 【核心修改】为内容容器添加特定类名，以便应用内边距 -->
    <div class="modal-content listening-content">
        <button class="modal-close-btn" id="listening-close-btn" title="退出听力模式">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
        <div class="listening-header">
            <h3 class="listening-mode-title">👂 听力磨耳朵</h3>
            <div class="listening-toggle-wrapper">
                <label for="audio-source-toggle" class="listening-label">单词</label>
                <div class="toggle-switch">
                    <label for="audio-source-toggle"><input type="checkbox" id="audio-source-toggle" checked><span class="slider"></span></label>
                </div>
                <label for="audio-source-toggle" class="listening-label">例句</label>
            </div>
        </div>
        <div class="listening-visual">
            <div class="audio-waves" id="audio-waves"><span></span><span></span><span></span><span></span><span></span></div>
            <button id="listening-replay-btn" class="listening-replay-btn" title="重播音频"><svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button>
        </div>
        <div class="listening-answer-area" id="listening-answer-area">
            <div class="listening-hidden-placeholder">点击下方“揭晓”查看内容</div>
            <div class="listening-revealed-content is-hidden">
                <h2 class="listening-word"></h2><div class="listening-meaning"></div><div class="listening-sentence-en"></div><div class="listening-sentence-cn"></div>
            </div>
        </div>
        <div class="listening-controls">
            <button id="listening-reveal-btn" class="control-btn btn-reveal">👀 揭晓答案</button>
            <button id="listening-next-btn" class="control-btn btn-next">⏭ 下一个</button>
        </div>
    </div>
</div>

<div id="typing-modal" class="modal-overlay is-hidden">
    <div class="modal-content typing-content">
        <div class="typing-header">
            <span class="typing-progress-text">进度: <span id="typing-progress-current">1</span> / <span id="typing-progress-total">10</span></span>
            <button class="modal-close-btn" id="typing-close-btn" title="退出打字模式">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div class="typing-prompt">
            <div class="typing-prompt-controls">
                <button id="typing-replay-audio-btn" class="icon-btn typing-audio-btn" title="重播发音"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg></button>
                <button id="typing-hint-btn" class="icon-btn typing-hint-btn" title="获取提示"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18h6M12 22V18M5.07 12.35a7 7 0 0 1 13.86 0M12 2a4 4 0 0 0-4 4c0 1.5.67 2.83 1.75 3.75V12h4.5v-2.25C15.33 8.83 16 7.5 16 6a4 4 0 0 0-4-4z"></path></svg></button>
            </div>
            <p class="typing-meaning" id="typing-meaning">Loading...</p>
            <p class="typing-sentence" id="typing-sentence">Loading sentence...</p>
        </div>
        <div class="typing-input-container">
            <input type="text" id="typing-input" class="typing-input" placeholder="输入单词..." autocomplete="off" spellcheck="false">
            <div id="typing-feedback-icon" class="typing-feedback-icon"></div>
        </div>
        <div id="typing-result-area" class="typing-result-area is-hidden">
            <p class="correct-answer-label">正确答案:</p>
            <p class="correct-answer-text" id="typing-correct-answer">WORD</p>
        </div>
        <div class="typing-controls">
            <button id="typing-submit-btn" class="control-btn btn-submit">提交 (Enter)</button>
            <button id="typing-next-btn" class="control-btn btn-next is-hidden">下一个 (Enter)</button>
        </div>
    </div>
</div>

<div id="wordbook-modal" class="modal-overlay is-hidden">
    <div class="modal-content wordbook-content">
        <div id="wordbook-view-list" class="wordbook-view-list">
            <div class="wordbook-header">
                <button id="wordbook-new-btn" class="icon-btn" title="新建单词本">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                </button>
                <h3>📚 我的单词本</h3>
                <!-- 【核心修改】将关闭按钮移到头部右侧区域，并移除已废弃的样式类 -->
                <button id="wordbook-close-btn" class="modal-close-btn" title="关闭">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div id="wordbook-list-container" class="wordbook-list-container">
                <p class="wordbook-empty-hint">暂无单词本，点击左上方“+”开始创建。</p>
            </div>
        </div>
        <div id="wordbook-view-editor" class="wordbook-view-editor is-hidden">
            <div class="wordbook-header">
                <button id="wordbook-back-btn" class="icon-btn" title="返回列表">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"></path><polyline points="12 19 5 12 12 5"></polyline></svg>
                </button>
                <h3 id="wordbook-editor-title">新建单词本</h3>
                <div style="width: 38px; height: 38px;"></div>
            </div>
            <div class="wordbook-section">
                <input type="text" id="wordbook-name-input" class="wordbook-name-input" placeholder="输入单词本名称 (e.g., 老友记S1E1)">
            </div>
            <div class="wordbook-section extraction-area">
                <label class="section-label">追加新单词</label>
                <textarea id="wordbook-text-input" placeholder="粘贴英文文本到此处..."></textarea>
                <div class="action-row">
                    <span id="wordbook-extract-status" class="status-text"></span>
                    <button id="wordbook-extract-btn" class="control-btn btn-reveal btn-compact">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v18m-9-9h18"/></svg>
                        提取并追加
                    </button>
                </div>
            </div>
            <div class="wordbook-section">
                <div class="list-header">
                    <label class="section-label">包含的单词 (<span id="wordbook-word-count">0</span>)</label>
                    <div class="list-actions">
                        <button id="wordbook-select-all-btn" class="icon-btn-sm" title="全选">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
                        </button>
                        <button id="wordbook-deselect-all-btn" class="icon-btn-sm" title="全不选">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                        </button>
                        <button id="wordbook-remove-learned-btn" class="icon-btn-sm" title="移除已掌握的单词">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <polyline points="9 14 11 16 15 11"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="wordbook-words-list" class="wordbook-words-list"></div>
            </div>
            <div class="wordbook-footer">
                <button id="wordbook-save-btn" class="control-btn btn-submit" disabled>保存修改</button>
            </div>
        </div>
    </div>
</div>

<div id="achievements-modal" class="modal-overlay is-hidden">
    <div class="modal-content achievements-content">
        <!-- 【核心修改】统一头部结构，确保关闭按钮位于右上角 -->
        <div class="achievements-header">
            <h3>🏆 学习成就 (Achievements)</h3>
            <button id="achievements-close-btn" class="modal-close-btn" title="关闭">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div id="achievements-list-container" class="achievements-list">
            <!-- 成就列表将由 JavaScript 动态生成 -->
        </div>
    </div>
</div>

<div id="heatmap-modal" class="modal-overlay is-hidden">
    <div class="modal-content heatmap-content">
        <!-- 【核心修改】复用统一的头部结构 -->
        <div class="achievements-header">
            <h3>🔥 学习轨迹 (Learning Heatmap)</h3>
            <button id="heatmap-close-btn" class="modal-close-btn" title="关闭">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div id="heatmap-container" class="heatmap-container">
            <!-- 热力图将由 JavaScript 动态生成 -->
        </div>
    </div>
</div>

<div id="dialogue-modal" class="modal-overlay is-hidden">
    <div class="modal-content dialogue-content">
        <!-- 头部: 仿卡片风格 -->
        <div class="dialogue-header">
            <div style="flex: 1;"></div> <!-- 用于布局的占位符 -->

            <!-- 操作按钮组 -->
            <div class="dialogue-actions-bar">
                <!-- 放弃/下一个 按钮 -->
                <button id="dialogue-give-up-btn" class="icon-btn dialogue-action-icon" title="放弃 / 显示答案">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                        <line x1="4" y1="22" x2="4" y2="15"></line>
                    </svg>
                </button>
                <button id="dialogue-close-btn" class="modal-close-btn" title="退出对话" style="position: relative; top: 0; right: 0; padding: 0;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
        </div>

        <!-- 聊天记录区域 -->
        <div id="dialogue-history" class="dialogue-history">
            <!-- 消息气泡将由 JavaScript 动态插入 -->
        </div>

        <!-- 底部输入框 (仿笔记输入风格) -->
        <div class="dialogue-input-area">
            <input id="dialogue-input" class="dialogue-text-input" placeholder="尝试用英语描述..." rows="1"></input>
            <button id="dialogue-send-btn" class="dialogue-send-btn" title="发送">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>
</div>

<!-- 卡片模板 -->
<template id="card-template">
    <div class="card">
        <div class="card-inner">
            <div class="card-front">
                <div class="prefix-badge"></div>
                <button class="toggle-prefix-btn" title="切换前缀图像">
                    <svg class="icon-eye" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    <svg class="icon-eye-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>
                </button>
                <button class="mark-btn" title="标记为已掌握">
                    <svg class="icon-check-empty" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                    <svg class="icon-check-filled" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg>
                </button>
                <div class="visual-area"></div>
                <div class="word-area">
                    <h2 class="word-text"></h2>
                    <button class="audio-btn word-audio" title="朗读单词"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg></button>
                    <button class="audio-btn note-btn" title="添加/查看笔记">
                        <svg class="icon-note-empty" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        <svg class="icon-note-filled" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            <path d="M8 13h5"></path><path d="M8 17h8"></path>
                        </svg>
                    </button>
                </div>
                <p class="hint-text">点击翻转查看解析</p>
                <div class="card-note-overlay is-hidden">
                    <textarea class="note-input" placeholder="输入你的联想笔记..."></textarea>
                    <div class="note-actions">
                        <button class="note-action-btn btn-cancel">取消</button>
                        <button class="note-action-btn btn-save">保存</button>
                    </div>
                </div>
            </div>
            <div class="card-back">
                <div class="breakdown-box"><span class="part-prefix"></span> + <span class="part-root"></span></div>
                <div class="meaning-section"><h3 class="cn-translation"></h3><p class="imagery-text"></p></div>
                <div class="sentence-section"></div>
            </div>
        </div>
    </div>
</template>

<!-- 前缀介绍卡片模板 -->
<template id="prefix-intro-template">
    <div class="card prefix-intro-card">
        <div class="card-inner">
            <div class="card-front">
                <div class="visual-area"></div><div class="word-area"><h2 class="intro-title"></h2></div><p class="hint-text">点击翻转查看联想记忆</p>
            </div>
            <div class="card-back">
                <div class="intro-section"><h3 class="intro-section-title">核心意境</h3><p class="intro-description"></p></div>
                <div class="intro-section"><h3 class="intro-section-title">联想记忆</h3><p class="intro-imagery"></p></div>
            </div>
        </div>
    </div>
</template>

<!-- 应用页脚 -->
<footer class="app-footer">
    <p>学习资料来源：韩宇极简英语 & AI 辅助生成</p>
    <p class="footer-meta">© 2024 cc | <a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备2024271251号</a> | <a href="./combiner" target="_blank">SVG 编辑</a> | <a href="javascript:void(0)" id="dsnr-trigger">DSNR</a> | <a href="https://github.com/git-hub-cc/RootCards" target="_blank">GitHub</a></p>
</footer>

<!-- 撤销操作通知栏 -->
<div id="undo-toast" class="undo-toast">
    <span id="undo-message" class="undo-message">操作已完成</span>
    <button id="undo-action-btn" class="undo-action-btn">撤销</button>
    <div class="undo-progress-bar-container">
        <div id="undo-progress-bar" class="undo-progress-bar"></div>
    </div>
</div>

<!-- 全局通知栏 -->
<div id="notification-toast" class="notification-toast">
    <span id="notification-icon" class="notification-icon"></span>
    <span id="notification-message" class="notification-message"></span>
</div>

<!-- 隐藏的文件导入输入框 -->
<input type="file" id="import-file-input" accept=".json" style="display: none;">

<!-- JavaScript 资源引入 -->
<script src="lib/compromise.js"></script>
<script src="js/ui-helpers.js"></script>
<script src="js/config.js" type="module"></script>
<script src="data/manifest.js"></script>
<script type="module" src="js/app.js"></script>

</body>
</html>